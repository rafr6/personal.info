<!doctype html>
<html lang="bn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>File Vault (PDF Fix)</title>
  <style>
    body{font-family:sans-serif;background:#f5f7fb;margin:0;padding:20px}
    .card{background:#fff;padding:16px;border-radius:10px;box-shadow:0 4px 12px rgba(0,0,0,.1);margin-bottom:20px}
    h2{margin:0 0 10px}
    input,button{padding:8px;border-radius:6px;border:1px solid #ccc}
    button{background:#0b74de;color:#fff;border:none;cursor:pointer}
    .folder{padding:10px;margin:10px 0;background:#fafafa;border:1px solid #ddd;border-radius:8px}
    .file-item{display:flex;justify-content:space-between;align-items:center;padding:6px;margin:5px 0;background:#fff;border:1px solid #eee;border-radius:6px}
    iframe,embed,video,img{width:100%;height:65vh;border:1px solid #ccc;border-radius:8px;background:#000}
    .muted{color:#666;font-size:14px}
    .small{font-size:13px;padding:5px 8px}
    .danger{background:#d9534f;color:#fff}
  </style>
</head>
<body>

<div class="card" id="loginCard">
  <h2>üîê ‡¶≤‡¶ó‡¶á‡¶®</h2>
  <input type="password" id="pw" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡¶ø‡¶®" />
  <button id="btnLogin">‡¶≤‡¶ó‡¶á‡¶®</button>
</div>

<div class="card" id="appCard" style="display:none">
  <h2>üìÅ File Vault</h2>
  <div>
    <input type="text" id="folderName" placeholder="‡¶´‡ßã‡¶≤‡ßç‡¶°‡¶æ‡¶∞‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ" />
    <button id="btnCreate">‡¶´‡ßã‡¶≤‡ßç‡¶°‡¶æ‡¶∞ ‡¶§‡ßà‡¶∞‡¶ø</button>
    <button id="btnLogout" class="small">‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</button>
  </div>
  <div id="folders"></div>

  <h3>Preview</h3>
  <div id="preview"></div>
</div>

<script>
const PASS_KEY="fv_pass";
let data = JSON.parse(localStorage.getItem("fv_data")||"{}");

function save(){ localStorage.setItem("fv_data",JSON.stringify(data)); }

document.getElementById('btnLogin').onclick=function(){
  let p=document.getElementById('pw').value.trim();
  let saved=localStorage.getItem(PASS_KEY);
  if(!saved){ localStorage.setItem(PASS_KEY,p); showApp(); }
  else if(p===saved){ showApp(); }
  else alert("‡¶≠‡ßÅ‡¶≤ ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°!");
};

document.getElementById('btnLogout').onclick=function(){
  document.getElementById('appCard').style.display="none";
  document.getElementById('loginCard').style.display="block";
};

function showApp(){
  document.getElementById('loginCard').style.display="none";
  document.getElementById('appCard').style.display="block";
  renderFolders();
}

document.getElementById('btnCreate').onclick=function(){
  let name=document.getElementById('folderName').value.trim();
  if(!name) return;
  if(!data[name]) data[name]=[];
  save(); renderFolders(); document.getElementById('folderName').value="";
};

function renderFolders(){
  let box=document.getElementById('folders'); box.innerHTML="";
  Object.keys(data).forEach(folder=>{
    let div=document.createElement('div');
    div.className="folder";
    div.innerHTML=`<b>${folder}</b> <input type="file" multiple onchange="uploadFiles('${folder}',this.files)">`;
    let list=document.createElement('div');
    data[folder].forEach((f,i)=>{
      let item=document.createElement('div');
      item.className="file-item";
      item.innerHTML=`<span>${f.name}</span>
      <div>
        <button class="small" onclick="previewFile('${folder}',${i})">Preview</button>
        <button class="small" onclick="downloadFile('${folder}',${i})">Download</button>
        <button class="small danger" onclick="deleteFile('${folder}',${i})">Delete</button>
      </div>`;
      list.appendChild(item);
    });
    div.appendChild(list); box.appendChild(div);
  });
}

function uploadFiles(folder,files){
  [...files].forEach(file=>{
    let reader=new FileReader();
    reader.onload=e=>{
      data[folder].push({name:file.name,type:file.type,data:e.target.result});
      save(); renderFolders();
    };
    reader.readAsDataURL(file);
  });
}

function previewFile(folder,i){
  let f=data[folder][i];
  let box=document.getElementById('preview');
  box.innerHTML="";
  if(f.type.includes("pdf")){
    // PDF safe preview: embed + fallback link
    let url=f.data;
    let embed=document.createElement("embed");
    embed.src=url; embed.type="application/pdf";
    box.appendChild(embed);
    let link=document.createElement("div");
    link.className="muted"; link.innerHTML=`<a href="${url}" target="_blank">Open PDF in new tab / Download</a>`;
    box.appendChild(link);
  }
  else if(f.type.includes("video")) box.innerHTML=`<video controls src="${f.data}"></video>`;
  else if(f.type.includes("image")) box.innerHTML=`<img src="${f.data}">`;
  else box.innerHTML=`<a href="${f.data}" download="${f.name}">Download ${f.name}</a>`;
}

function downloadFile(folder,i){
  let f=data[folder][i]; let a=document.createElement('a');
  a.href=f.data; a.download=f.name; a.click();
}

function deleteFile(folder,i){
  if(confirm("‡¶´‡¶æ‡¶á‡¶≤ ‡¶Æ‡ßÅ‡¶õ‡¶¨‡ßá‡¶®?")){ data[folder].splice(i,1); save(); renderFolders(); document.getElementById('preview').innerHTML=""; }
}
</script>
</body>
</html>
