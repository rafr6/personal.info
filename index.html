<!doctype html>
<html lang="bn">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ফাইল ম্যানেজার — অফিস ডকুমেন্টস (Protected)</title>
<style>
:root{--bg:#f7f8fb;--card:#fff;--accent:#2563eb}
body{font-family: system-ui,-apple-system,Segoe UI,Roboto,'Noto Sans Bengali',sans-serif;background:var(--bg);margin:0;padding:20px;color:#0f172a}
.container{max-width:980px;margin:0 auto}
header{display:flex;justify-content:space-between;align-items:center;margin-bottom:18px}
h1{font-size:20px;margin:0}
.card{background:var(--card);border-radius:10px;padding:14px;box-shadow:0 6px 18px rgba(15,23,42,0.06);}
.flex{display:flex;gap:12px}
.col{flex:1}
input[type=text],input[type=password],select{width:100%;padding:10px;border-radius:8px;border:1px solid #e6e9ef}
button{background:var(--accent);color:#fff;border:0;padding:8px 12px;border-radius:8px;cursor:pointer}
small{color:#475569}
.folders{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
.folder{padding:8px 12px;border-radius:8px;background:#eef2ff;color:#1e293b;cursor:pointer}
.folder.active{background:#2563eb;color:#fff}
.files{margin-top:12px}
.file{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:8px;border:1px solid #eef2f6;margin-bottom:8px}
.file .meta{display:flex;gap:12px;align-items:center}
.preview{max-width:100%;height:360px;border:1px solid #e2e8f0;border-radius:8px;padding:6px;position:relative}
.top-actions{display:flex;gap:8px;flex-wrap:wrap}
.muted{color:#64748b}
footer{margin-top:18px;text-align:center;color:#64748b}
.overlay{position:fixed;inset:0;background:rgba(15,23,42,0.6);display:flex;align-items:center;justify-content:center;z-index:9999}
.auth-box{background:#fff;padding:20px;border-radius:12px;max-width:420px;width:95%;box-shadow:0 10px 30px rgba(2,6,23,0.3)}
.hint{font-size:13px;color:#475569;margin-top:8px}
.watermark{position:absolute;top:8px;left:8px;font-size:13px;color:rgba(255,0,0,0.35);pointer-events:none;user-select:none}
@media(max-width:640px){.flex{flex-direction:column}}
iframe, video{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;}
</style>
</head>
<body>
<div class="container">
<header>
<h1>অফিস ফাইল ম্যানেজার (Protected)</h1>
<small class="muted">লোকালি ব্রাউজারে সংরক্ষণ — পাসওয়ার্ড দিয়ে রক্ষা করা আছে</small>
</header>

<div id="app" style="display:none">
  <div class="card">
    <div class="flex">
      <div class="col">
        <label>নতুন ফোল্ডার নাম</label>
        <input id="newFolderName" type="text" placeholder="উদাহরণ: PDFs, Videos, ProjectA" />
      </div>
      <div style="display:flex;align-items:flex-end;gap:8px">
        <button id="createFolderBtn">ফোল্ডার তৈরি</button>
      </div>
    </div>

    <div class="folders" id="foldersList"></div>
    <hr style="margin:14px 0" />

    <div class="flex">
      <div class="col">
        <label>ফাইল আপলোড করুন (PDF বা ভিডিও)</label>
        <input id="fileInput" type="file" accept="application/pdf,video/*" multiple />
        <small class="muted">আপলোডকৃত ফাইলগুলো ব্রাউজারের IndexedDB-এ সংরক্ষিত থাকবে।</small>
      </div>
      <div style="display:flex;align-items:flex-end;gap:8px">
        <select id="targetFolderSelect"></select>
        <button id="uploadBtn">আপলোড</button>
      </div>
    </div>

    <div class="files" id="filesList"></div>
    <div style="margin-top:12px;position:relative" id="previewWrap">
      <div id="previewArea"></div>
      <div class="watermark" id="wmText">Confidential</div>
    </div>
  </div>
  <footer><small>নোট: এই অ্যাপ ব্রাউজারের IndexedDB-এ ডেটা রাখে।</small></footer>
</div>

<!-- Overlay -->
<div id="overlay" class="overlay">
<div class="auth-box" id="authBox">
<h3 id="authTitle">লগইন</h3>
<div id="loginArea">
<p>পাসওয়ার্ড দিন</p>
<input id="inPass" type="password" placeholder="পাসওয়ার্ড" />
<div style="display:flex;gap:8px;margin-top:12px">
<button id="doLogin">লগইন</button>
</div>
<small class="hint">ডিফল্ট পাসওয়ার্ড: <b>Ajhar123</b></small>
</div>
</div>
</div>

<script>
// ===== Auth =====
const DEFAULT_PASSWORD = "Ajhar123";
function getStorage(){ return window.localStorage; }
function hasPasswordSet(){ return !!getStorage().getItem('office_pwd'); }
function setPassword(p){ getStorage().setItem('office_pwd',p); }
function verifyPassword(p){ return p === getStorage().getItem('office_pwd'); }
function clearAuthOverlay(){ getStorage().setItem('office_logged_in','1'); document.getElementById('overlay').style.display='none'; document.getElementById('app').style.display='block'; initApp(); }

document.addEventListener('DOMContentLoaded', ()=>{
  if(!hasPasswordSet()){ setPassword(DEFAULT_PASSWORD); }
  if(getStorage().getItem('office_logged_in')==='1'){ clearAuthOverlay(); }
});

document.getElementById('doLogin').addEventListener('click', ()=>{
  const p=document.getElementById('inPass').value;
  if(verifyPassword(p)){ clearAuthOverlay(); }
  else{ alert('পাসওয়ার্ড ভুল।'); }
});

// ===== IndexedDB =====
const DB_NAME='office-files-db'; const DB_STORE='files'; let db; let currentFolder=null;
function openDB(){return new Promise((resolve,reject)=>{const req=indexedDB.open(DB_NAME,1);
req.onupgradeneeded=e=>{const idb=e.target.result; if(!idb.objectStoreNames.contains(DB_STORE)){const store=idb.createObjectStore(DB_STORE,{keyPath:'id'}); store.createIndex('folder','folder',{unique:false});}};
req.onsuccess=e=>{db=e.target.result;resolve(db);}; req.onerror=e=>reject(e.target.error);})}
function id(){return 'f_'+Date.now()+'_'+Math.random().toString(36).slice(2,7);}
async function createFolder(name){const tx=db.transaction(DB_STORE,'readwrite'); tx.objectStore(DB_STORE).add({id:id(), type:'folder', name, created:Date.now()}); return tx.complete||new Promise(r=>tx.oncomplete=r);}
async function getFolders(){return new Promise((resolve,reject)=>{const tx=db.transaction(DB_STORE,'readonly'); const store=tx.objectStore(DB_STORE); const items=[]; const req=store.openCursor();
req.onsuccess=e=>{const cur=e.target.result;if(cur){if(cur.value.type==='folder') items.push(cur.value);cur.continue();} else resolve(items.sort((a,b)=>a.created-b.created));};
req.onerror=e=>reject(e.target.error);});}
async function addFileToFolder(file,folderId){return new Promise((resolve,reject)=>{
  const reader=new FileReader();
  reader.onload=ev=>{
    const obj={id:id(), type:'file', name:file.name, mime:file.type, size:file.size, folder:folderId, created:Date.now(), data:new Uint8Array(ev.target.result)};
    const tx=db.transaction(DB_STORE,'readwrite'); tx.objectStore(DB_STORE).add(obj); tx.oncomplete=()=>resolve(); tx.onerror=e=>reject(e.target.error);
  }; reader.readAsArrayBuffer(file);
});}
async function getFilesForFolder(folderId){return new Promise((resolve,reject)=>{const tx=db.transaction(DB_STORE,'readonly'); const index=tx.objectStore(DB_STORE).index('folder'); const req=index.getAll(folderId);
req.onsuccess=e=>resolve(e.target.result.sort((a,b)=>b.created-a.created)); req.onerror=e=>reject(e.target.error);});}
async function deleteItem(idToDelete){return new Promise((resolve,reject)=>{const tx=db.transaction(DB_STORE,'readwrite'); tx.objectStore(DB_STORE).delete(idToDelete); tx.oncomplete=()=>resolve(); tx.onerror=e=>reject(e.target.error);});}
function readableSize(bytes){if(bytes<1024) return bytes+' bytes'; const kb=bytes/1024; if(kb<1024) return kb.toFixed(1)+' KB'; const mb=kb/1024; if(mb<1024) return mb.toFixed(1)+' MB'; return (mb/1024).toFixed(2)+' GB';}

// ===== Preview =====
function previewFile(file){
  const blob=new Blob([file.data.buffer],{type:file.mime});
  const url=URL.createObjectURL(blob);
  const area=document.getElementById('previewArea'); area.innerHTML='';
  document.getElementById('wmText').textContent=`Confidential • ${new Date().toLocaleDateString()}`;
  if(file.mime==='application/pdf'){
    const iframe=document.createElement('iframe');
    iframe.src=url; iframe.width='100%'; iframe.height='360px'; area.appendChild(iframe);
  } else if(file.mime.startsWith('video/')){
    const vid=document.createElement('video'); vid.className='preview'; vid.controls=true; vid.src=url; area.appendChild(vid);
  } else { area.textContent='প্রিভিউ নেই'; }
}

// ===== UI Update =====
async function updateUI(){
  const folders=await getFolders(); const foldersList=document.getElementById('foldersList'); const targetSelect=document.getElementById('targetFolderSelect');
  foldersList.innerHTML=''; targetSelect.innerHTML='';
  const def=document.createElement('option'); def.value=''; def.text='--- নির্বাচন করুন ---'; targetSelect.appendChild(def);
  folders.forEach(f=>{const div=document.createElement('div'); div.className='folder'; div.textContent=f.name; div.onclick=()=>{currentFolder=f.id; updateFiles(); Array.from(foldersList.children).forEach(c=>c.classList.remove('active')); div.classList.add('active');}; foldersList.appendChild(div);
  const opt=document.createElement('option'); opt.value=f.id; opt.text=f.name; targetSelect.appendChild(opt);});
}
async function updateFiles(){if(!currentFolder){document.getElementById('filesList').innerHTML=''; return;}
const files=await getFilesForFolder(currentFolder); const filesList=document.getElementById('filesList'); filesList.innerHTML='';
files.forEach(f=>{const div=document.createElement('div'); div.className='file'; const meta=document.createElement('div'); meta.className='meta'; meta.textContent=f.name+' ('+readableSize(f.size)+')'; div.appendChild(meta);
const actions=document.createElement('div'); const pbtn=document.createElement('button'); pbtn.textContent='প্রিভিউ'; pbtn.onclick=()=>previewFile(f); actions.appendChild(pbtn);
const rbtn=document.createElement('button'); rbtn.textContent='মুছুন'; rbtn.onclick=async()=>{await deleteItem(f.id);updateFiles();}; actions.appendChild(rbtn); div.appendChild(actions); filesList.appendChild(div);});
}

// ===== Init =====
async function initApp(){await openDB(); await updateUI();}
document.getElementById('createFolderBtn').addEventListener('click',async()=>{const n=document.getElementById('newFolderName').value.trim();if(!n)return;await createFolder(n);document.getElementById('newFolderName').value='';updateUI();});
document.getElementById('uploadBtn').addEventListener('click',async()=>{const inp=document.getElementById('fileInput');const fldr=document.getElementById('targetFolderSelect').value;if(!inp.files.length||!fldr){alert('ফাইল ও ফোল্ডার নির্বাচন করুন');return;}for(const f of inp.files){await addFileToFolder(f,fldr);}inp.value='';updateFiles();});
</script>
</body>
</html>
