<!doctype html>
<html lang="bn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ফাইল ম্যানেজার — অফিস ডকুমেন্টস (Protected)</title>
  <style>
    :root{--bg:#f7f8fb;--card:#fff;--accent:#2563eb}
    body{font-family: system-ui,-apple-system,Segoe UI,Roboto,'Noto Sans Bengali',sans-serif;background:var(--bg);margin:0;padding:20px;color:#0f172a}
    .container{max-width:980px;margin:0 auto}
    header{display:flex;justify-content:space-between;align-items:center;margin-bottom:18px}
    h1{font-size:20px;margin:0}
    .card{background:var(--card);border-radius:10px;padding:14px;box-shadow:0 6px 18px rgba(15,23,42,0.06);}
    .flex{display:flex;gap:12px}
    .col{flex:1}
    input[type=text],input[type=password],select{width:100%;padding:10px;border-radius:8px;border:1px solid #e6e9ef}
    button{background:var(--accent);color:#fff;border:0;padding:8px 12px;border-radius:8px;cursor:pointer}
    small{color:#475569}
    .folders{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
    .folder{padding:8px 12px;border-radius:8px;background:#eef2ff;color:#1e293b;cursor:pointer}
    .folder.active{background:#2563eb;color:#fff}
    .files{margin-top:12px}
    .file{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:8px;border:1px solid #eef2f6;margin-bottom:8px}
    .file .meta{display:flex;gap:12px;align-items:center}
    .preview{max-width:100%;height:360px;border:1px solid #e2e8f0;border-radius:8px;padding:6px;position:relative}
    .top-actions{display:flex;gap:8px;flex-wrap:wrap}
    .muted{color:#64748b}
    footer{margin-top:18px;text-align:center;color:#64748b}
    .overlay{position:fixed;inset:0;background:rgba(15,23,42,0.6);display:flex;align-items:center;justify-content:center;z-index:9999}
    .auth-box{background:#fff;padding:20px;border-radius:12px;max-width:420px;width:95%;box-shadow:0 10px 30px rgba(2,6,23,0.3)}
    .hint{font-size:13px;color:#475569;margin-top:8px}
    .watermark{position:absolute;top:8px;left:8px;font-size:13px;color:rgba(255,0,0,0.35);pointer-events:none;user-select:none}
    @media(max-width:640px){.flex{flex-direction:column}}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
</head>
<body>
<div class="container">
  <header>
    <h1>অফিস ফাইল ম্যানেজার (Protected)</h1>
    <small class="muted">লোকালি ব্রাউজারে সংরক্ষণ — পাসওয়ার্ড দিয়ে রক্ষা করা আছে</small>
  </header>

  <div id="app" style="display:none">
    <!-- মূল অ্যাপ কোড এখানে থাকবে -->
    <!-- একই কোড আগের মতোই থাকবে -->
  </div>

  <div id="overlay" class="overlay" style="display:flex">
    <div class="auth-box" id="authBox">
      <h3 id="authTitle">লগইন</h3>
      <div id="setupArea" style="display:none">
        <p>প্রথমবার সাইটটি ব্যবহার করছেন — অনুগ্রহ করে একটি নতুন পাসওয়ার্ড সেট করুন।</p>
        <input id="newPass" type="password" placeholder="নতুন পাসওয়ার্ড (কমপক্ষে 6 অক্ষর)" />
        <input id="confirmPass" type="password" placeholder="পাসওয়ার্ড নিশ্চিত করুন" style="margin-top:8px"/>
        <div style="display:flex;gap:8px;margin-top:12px">
          <button id="doSetPass">সেভ করুন</button>
          <button id="cancelSet" style="background:#94a3b8">বাতিল</button>
        </div>
        <div class="hint">পাসওয়ার্ড লস হলে রিকভার করার উপায় নেই — LocalStorage/IndexedDB ক্লিয়ার করলে রিসেট করা যাবে।</div>
      </div>

      <div id="loginArea">
        <p>পাসওয়ার্ড দিন</p>
        <input id="inPass" type="password" placeholder="পাসওয়ার্ড" />
        <div style="display:flex;gap:8px;margin-top:12px">
          <button id="doLogin">লগইন</button>
          <button id="showSet" style="background:#94a3b8">পাসওয়ার্ড সেট/রিসেট</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// ====== Configurable default password ======
const DEFAULT_PASSWORD = "Ajhar123"; // <-- কোড থেকে এখানেই পাসওয়ার্ড পরিবর্তন করতে হবে

// ====== Auth helpers (Web Crypto SHA-256) ======
async function sha256hex(str){
  const enc = new TextEncoder();
  const buf = await crypto.subtle.digest('SHA-256', enc.encode(str));
  return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,'0')).join('');
}
function getStorage(){ return window.localStorage; }
function hasPasswordSet(){ return !!getStorage().getItem('office_pwd_hash'); }
function randSalt(){ return Math.random().toString(36).slice(2,10); }

async function setPassword(plain){
  const salt = randSalt();
  const h = await sha256hex(salt + '|' + plain);
  getStorage().setItem('office_pwd_hash', h);
  getStorage().setItem('office_pwd_salt', salt);
}

async function verifyPassword(plain){
  const salt = getStorage().getItem('office_pwd_salt') || '';
  const h = await sha256hex(salt + '|' + plain);
  return h === getStorage().getItem('office_pwd_hash');
}

async function ensureDefaultPassword(){
  if(!hasPasswordSet()){
    await setPassword(DEFAULT_PASSWORD);
  }
}

function clearAuthOverlay(){ document.getElementById('overlay').style.display='none'; document.getElementById('app').style.display='block'; }
function showSetup(){ document.getElementById('loginArea').style.display='none'; document.getElementById('setupArea').style.display='block'; document.getElementById('authTitle').textContent='পাসওয়ার্ড সেট করুন'; }
function showLogin(){ document.getElementById('loginArea').style.display='block'; document.getElementById('setupArea').style.display='none'; document.getElementById('authTitle').textContent='লগইন'; }

document.addEventListener('DOMContentLoaded', async ()=>{
  await ensureDefaultPassword(); // এখানে ডিফল্ট পাসওয়ার্ড নিশ্চিত হচ্ছে
  if(!hasPasswordSet()){
    showSetup();
  } else {
    showLogin();
  }
});

// ===== Auth button handlers =====
document.getElementById('doSetPass').addEventListener('click', async ()=>{
  const a = document.getElementById('newPass').value.trim();
  const b = document.getElementById('confirmPass').value.trim();
  if(a.length < 6){ alert('কমপক্ষে 6 অক্ষরের পাসওয়ার্ড দিন'); return; }
  if(a !== b){ alert('পাসওয়ার্ড মিলছে না'); return; }
  await setPassword(a);
  alert('পাসওয়ার্ড সেভ হয়েছে — এখন লগইন করুন'); 
  document.getElementById('newPass').value=''; document.getElementById('confirmPass').value='';
  showLogin();
});

document.getElementById('doLogin').addEventListener('click', async ()=>{
  const p = document.getElementById('inPass').value;
  if(!p){ alert('পাসওয়ার্ড দিন'); return; }
  const ok = await verifyPassword(p);
  if(ok){ document.getElementById('inPass').value=''; clearAuthOverlay(); initApp(); }
  else{ alert('পাসওয়ার্ড ভুল।'); }
});

document.getElementById('showSet').addEventListener('click', ()=>{
  if(confirm('পাসওয়ার্ড রিসেট করলে পুরনো পাসওয়ার্ড কাজ করবে না। আপনি কি নিশ্চিত?')){
    getStorage().removeItem('office_pwd_hash'); getStorage().removeItem('office_pwd_salt');
    showSetup();
  }
});
document.getElementById('cancelSet').addEventListener('click', ()=>{ showLogin(); });

// ===== এখানে আগের IndexedDB এবং ফাইল ম্যানেজার কোড থাকবে =====
</script>
</body>
</html>
