<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <title>à¦«à¦¾à¦‡à¦² à¦†à¦ªà¦²à§‹à¦¡à¦¾à¦° à¦“ à¦­à¦¿à¦‰à§Ÿà¦¾à¦°</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f5f5f5; padding: 20px; }
    h2 { color: #333; }
    #fileList { margin-top: 20px; }
    .file-item { background: white; padding: 10px; margin: 5px 0; border-radius: 8px;
                 display: flex; justify-content: space-between; align-items: center; }
    .preview { margin-top: 20px; padding: 10px; background: white; border-radius: 8px; }
    button { margin-left: 5px; }
  </style>
</head>
<body>
  <h2>ðŸ“‚ à¦«à¦¾à¦‡à¦² à¦†à¦ªà¦²à§‹à¦¡à¦¾à¦° à¦“ à¦­à¦¿à¦‰à§Ÿà¦¾à¦°</h2>

  <input type="file" id="fileInput" multiple>
  <input type="text" id="folderInput" placeholder="à¦«à§‹à¦²à§à¦¡à¦¾à¦°à§‡à¦° à¦¨à¦¾à¦® (à¦¯à§‡à¦®à¦¨: pdf)">
  <button id="uploadBtn">Upload</button>

  <div id="progress"></div>

  <h3>Uploaded Files</h3>
  <div id="fileList"></div>

  <div class="preview" id="preview"></div>

  <!-- Firebase SDKs -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getStorage, ref, uploadBytesResumable, getDownloadURL, deleteObject }
      from "https://www.gstatic.com/firebasejs/11.0.1/firebase-storage.js";
    import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, doc }
      from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    // âœ… à¦†à¦ªà¦¨à¦¾à¦° Firebase Config à¦¬à¦¸à¦¾à¦¨à§‹ à¦¹à¦²à§‹
    const firebaseConfig = {
      apiKey: "AIzaSyAyBGfqFXJq8N8Z4yQQQQhuhgHRiSizbrY",
      authDomain: "my-file-storage-cc7dc.firebaseapp.com",
      projectId: "my-file-storage-cc7dc",
      storageBucket: "my-file-storage-cc7dc.firebasestorage.app",
      messagingSenderId: "857948023439",
      appId: "1:857948023439:web:576dc062461b6906185efa",
      measurementId: "G-8FLNEHFT3N"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const storage = getStorage(app);

    const fileInput = document.getElementById("fileInput");
    const folderInput = document.getElementById("folderInput");
    const uploadBtn = document.getElementById("uploadBtn");
    const fileList = document.getElementById("fileList");
    const progress = document.getElementById("progress");
    const preview = document.getElementById("preview");

    // Upload button click
    uploadBtn.onclick = async () => {
      const files = fileInput.files;
      const folder = folderInput.value || "general";
      if (!files.length) { alert("à¦•à§‹à¦¨à§‹ à¦«à¦¾à¦‡à¦² à¦¸à¦¿à¦²à§‡à¦•à§à¦Ÿ à¦•à¦°à§à¦¨!"); return; }

      for (const file of files) {
        const storageRef = ref(storage, folder + "/" + file.name);
        const uploadTask = uploadBytesResumable(storageRef, file);

        uploadTask.on("state_changed", (snapshot) => {
          const percent = ((snapshot.bytesTransferred / snapshot.totalBytes) * 100).toFixed(0);
          progress.innerText = `Uploading ${file.name}: ${percent}%`;
        },
        (error) => { console.error(error); },
        async () => {
          const url = await getDownloadURL(uploadTask.snapshot.ref);
          await addDoc(collection(db, "files"), {
            name: file.name,
            folder,
            url,
            type: file.type,
            created: new Date().toISOString(),
            path: folder + "/" + file.name
          });
          progress.innerText = "";
        });
      }
    };

    // Show file list realtime
    onSnapshot(collection(db, "files"), (snapshot) => {
      fileList.innerHTML = "";
      snapshot.forEach((docSnap) => {
        const data = docSnap.data();
        const div = document.createElement("div");
        div.className = "file-item";
        div.innerHTML = `
          <span>${data.folder}/${data.name}</span>
          <span>
            <button onclick="window.open('${data.url}', '_blank')">Open</button>
            <button onclick="downloadFile('${data.url}', '${data.name}')">Download</button>
            <button onclick="deleteFile('${docSnap.id}', '${data.path}')">Delete</button>
          </span>
        `;
        fileList.appendChild(div);
      });
    });

    // Download
    window.downloadFile = (url, name) => {
      const a = document.createElement("a");
      a.href = url;
      a.download = name;
      a.click();
    };

    // Delete
    window.deleteFile = async (id, path) => {
      if (!confirm("à¦«à¦¾à¦‡à¦²à¦Ÿà¦¿ à¦¡à¦¿à¦²à¦¿à¦Ÿ à¦•à¦°à¦¬à§‡à¦¨?")) return;
      await deleteDoc(doc(db, "files", id));
      await deleteObject(ref(storage, path));
    };
  </script>
</body>
</html>
